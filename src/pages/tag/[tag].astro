---
import type { CollectionEntry } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Main from "@/layouts/Main.astro";
import { getPosts } from "@/utils/getPosts";
import { getUniqueTags } from "@/utils/getUniqueTags";
import { getPostsByTag } from "@/utils/getPostsByTag";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import PostCard from "@/components/PostCard.astro";
import { SITE_TITLE } from "@/config";

interface Props {
  posts: CollectionEntry<"blog">[];
  tag: string;
}

export const getStaticPaths = async () => {
  const posts = await getPosts();
  const tags = getUniqueTags(posts);

  return tags.map((tag) => {
    return {
      params: {
        tag,
      },
      props: {
        tag,
        posts: getPostsByTag(posts, tag),
      },
    };
  });
};

const { tag, posts } = Astro.props;
---

<Layout title={`タグ: ${tag} | ${SITE_TITLE}`}>
  <Header />
  <Main title={`タグ: ${tag}`} description=`タグ: ${tag}の記事一覧です。`>
    {
      posts.map((post) => {
        return (
          <PostCard
            slug={post.slug}
            publishDate={post.data.publishDate}
            updateDate={post.data.updateDate}
            title={post.data.title}
            tags={post.data.tags}
          />
        );
      })
    }
  </Main>
  <Footer />
</Layout>
